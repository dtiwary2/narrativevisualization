<html>
<script src='https://d3js.org/d3.v4.js'></script>
<style> circle {fill: lightblue; stroke: black;} </style>
<!-- body onload='init()' -->

<!-- Initialize a select button -->
<div>
<select id="selectButtonFuel"></select>
</div>
<select id="selectButtonMake"></select>

<div>
<input type="button" value="Previous page" onclick="location.href='page3.html'"/>

</div>
<svg width=600 height=600>
</svg>
<script>

var svg=d3.select("svg")
	.attr("width", 500+6*50)
	.attr("height", 500+3*50)
	.append("g")
	.attr("transform","translate("+250+","+20+")")

//async function init() {
d3.csv("https://flunky.github.io/cars2017.csv", function(data)
{
	// List of groups (here I have one group per column)
	var FuelType = d3.map(data, function(d){return d.Fuel}).keys()
	var Make = d3.map(data, function(d){return d.Make}).keys()

	// add the options to the button
	d3.select("#selectButtonFuel")
	  .selectAll('myOptions')
		.data(FuelType)
	  .enter()
		.append('option')
	  .text(function (d) { return d; }) // text showed in the menu
	  .attr("value", function (d) { return d; }) // corresponding value returned by the button
	  
	d3.select("#selectButtonMake")
	  .selectAll('myOptions')
		.data(Make)
	  .enter()
		.append('option')
	  .text(function (d) { return d; }) // text showed in the menu
	  .attr("value", function (d) { return d; }) // corresponding value returned by the button
		  
	var x = d3.scaleLog().domain([10,150]).range([0,500]).base(10)
	var y = d3.scaleLog().domain([10,150]).range([500,0]).base(10)

	d3.select("svg")
		.append("g")
		.attr("transform","translate("+250+","+20+")")
		.call(d3.axisLeft(y).tickValues([10,20,50,100,150]).tickFormat(d3.format("2")));

	d3.select("svg")
		.append("g")
		.attr("transform","translate("+250+","+520+")")
		.call(d3.axisBottom(x).tickValues([10,20,50,100,150]).tickFormat(d3.format("2")))

	var graph=
		svg
		.append('g')
		.selectAll("circle").data(data)
		.enter()
		.append("circle")

	graph
		.filter(function(d){return (d.Fuel==FuelType[0] && d.Make==Make[0]) })
		.style("fill", "none")
		.style("stroke",function(d) { if (d.Fuel == "Gasoline") return "blue"
									  else if (d.Fuel == "Diesel") return "yellow" 
									  else if (d.Fuel == "Electricity") return "green" })
		.style("stroke-width","2")
		.attr("cx",function(d,i) { return x(d.AverageCityMPG) })
		.attr("cy",function(d) { return 500-x( Number(d.AverageHighwayMPG)); })
		.attr("r", function(d) { return 5+ Number(d.EngineCylinders) });


	// A function that update the chart
	function update(FuelFilter,MakeFilter) {

		  // Create new data with the selection?
		  //var dataFilter = data.filter(function(d){return d.Fuel==selectedGroup})

		  // Give these new data to update line
		d3.selectAll("g > *").remove();
		var graph=
		svg
		.append('g')
		.selectAll("circle").data(data)
		.enter()
		.append("circle")

		graph
		.filter(function(d) { return (d.Fuel == FuelFilter && d.Make == MakeFilter) })
				  .transition()
				  .duration(1000)
		.style("fill", "none")
		.style("stroke",function(d) { if (d.Fuel == "Gasoline") return "blue"
									  else if (d.Fuel == "Diesel") return "yellow" 
									  else if (d.Fuel == "Electricity") return "green" })
		.style("stroke-width","2")
		.attr("cx",function(d,i) { return x(d.AverageCityMPG) })
		.attr("cy",function(d) { return 500-x( Number(d.AverageHighwayMPG)); })
		.attr("r", function(d) { return 5+ Number(d.EngineCylinders) });
		
		d3.select("svg")
		.append("g")
		.attr("transform","translate("+250+","+20+")")
		.call(d3.axisLeft(y).tickValues([10,20,50,100,150]).tickFormat(d3.format("2")));

		d3.select("svg")
		.append("g")
		.attr("transform","translate("+250+","+520+")")
		.call(d3.axisBottom(x).tickValues([10,20,50,100,150]).tickFormat(d3.format("2")))
			  
	}

    // When the button is changed, run the updateChart function
    d3.select("#selectButtonFuel").on("change", function(d) {
        // recover the option that has been chosen
        var FuelFilter = d3.select(this).property("value")
		var MakeFilter = d3.select("#selectButtonMake").property("value")
        // run the updateChart function with this selected option
        update(FuelFilter,MakeFilter )
    })
	
	// When the button is changed, run the updateChart function
    d3.select("#selectButtonMake").on("change", function(d) {
        // recover the option that has been chosen
        var MakeFilter = d3.select(this).property("value")
		var FuelFilter = d3.select("#selectButtonFuel").property("value")
        // run the updateChart function with this selected option
        update(FuelFilter,MakeFilter)
    })


})

</script>

</body>
</html>

